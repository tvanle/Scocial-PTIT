generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Post {
  id            String      @id @default(uuid())
  authorId      String
  content       String
  media         Json?       // Array of media objects
  feeling       String?
  location      String?
  taggedUserIds String[]
  privacy       PostPrivacy @default(PUBLIC)
  groupId       String?
  sharedPostId  String?
  likesCount    Int         @default(0)
  commentsCount Int         @default(0)
  sharesCount   Int         @default(0)
  isEdited      Boolean     @default(false)
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt

  // Relations
  comments   Comment[]
  likes      PostLike[]
  saves      PostSave[]
  shares     Post[]      @relation("SharedPost")
  sharedPost Post?       @relation("SharedPost", fields: [sharedPostId], references: [id])
  reports    PostReport[]

  @@index([authorId])
  @@index([groupId])
  @@index([createdAt])
}

model Comment {
  id            String    @id @default(uuid())
  postId        String
  authorId      String
  content       String
  media         Json?     // Single media object
  parentId      String?
  likesCount    Int       @default(0)
  repliesCount  Int       @default(0)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  // Relations
  post     Post          @relation(fields: [postId], references: [id], onDelete: Cascade)
  parent   Comment?      @relation("CommentReplies", fields: [parentId], references: [id], onDelete: Cascade)
  replies  Comment[]     @relation("CommentReplies")
  likes    CommentLike[]

  @@index([postId])
  @@index([authorId])
  @@index([parentId])
}

model PostLike {
  id        String   @id @default(uuid())
  postId    String
  userId    String
  createdAt DateTime @default(now())

  post Post @relation(fields: [postId], references: [id], onDelete: Cascade)

  @@unique([postId, userId])
  @@index([postId])
  @@index([userId])
}

model CommentLike {
  id        String   @id @default(uuid())
  commentId String
  userId    String
  createdAt DateTime @default(now())

  comment Comment @relation(fields: [commentId], references: [id], onDelete: Cascade)

  @@unique([commentId, userId])
  @@index([commentId])
  @@index([userId])
}

model PostSave {
  id        String   @id @default(uuid())
  postId    String
  userId    String
  createdAt DateTime @default(now())

  post Post @relation(fields: [postId], references: [id], onDelete: Cascade)

  @@unique([postId, userId])
  @@index([userId])
}

model PostReport {
  id        String       @id @default(uuid())
  postId    String
  userId    String
  reason    String
  status    ReportStatus @default(PENDING)
  createdAt DateTime     @default(now())

  post Post @relation(fields: [postId], references: [id], onDelete: Cascade)

  @@index([postId])
  @@index([status])
}

enum PostPrivacy {
  PUBLIC
  FRIENDS
  PRIVATE
}

enum ReportStatus {
  PENDING
  REVIEWED
  RESOLVED
  REJECTED
}
